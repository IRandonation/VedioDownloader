# 重构软件计划：基于 Flet 的现代化视频工具箱

我将基于您的需求，使用 `Flet` 框架重构整个应用，实现视频下载、格式转换和语音转文字三大核心功能。

## 1. 项目结构重组
将单文件结构拆分为模块化结构，提高代码可维护性：
```text
video_downloader/
├── core/                   # 核心功能模块
│   ├── downloader.py       # you-get 下载逻辑封装
│   ├── converter.py        # ffmpeg 转换逻辑封装
│   └── transcriber.py      # Whisper 语音转文字逻辑封装 (新增)
├── ui/                     # Flet 界面模块
│   ├── components/         # 通用组件 (卡片, 按钮等)
│   ├── views/              # 页面视图
│   │   ├── download_view.py    # 下载页面
│   │   ├── convert_view.py     # 转换页面
│   │   └── transcribe_view.py  # 字幕提取页面
│   └── app_layout.py       # 主布局框架
├── utils/                  # 工具类
│   ├── config.py           # 配置管理
│   └── logger.py           # 日志管理
├── main.py                 # 程序入口
└── pyproject.toml          # 依赖管理 (uv)
```

## 2. 核心功能实现

### 2.1 视频下载 (基于 you-get)
- **功能增强**：
  - 输入 URL 后异步获取视频信息（避免界面卡顿）。
  - 解析 `you-get` JSON 输出，提取分辨率、格式、大小信息。
  - 在下拉菜单中展示清晰的质量选项（如 "1080P (mp4) - 50MB"）。
  - 支持导入 cookies.txt 解决登录限制。
  - 实时显示下载进度条。

### 2.2 视频转 MP3 (基于 ffmpeg)
- **功能实现**：
  - 调用 `ffmpeg` 将视频文件转换为 MP3。
  - 支持批量转换（预留接口）。
  - 提供简单的进度反馈。

### 2.3 视频提取文字 (基于 OpenAI-Whisper)
- **功能实现**：
  - 集成 `openai-whisper` 库。
  - 提供模型选择（Tiny, Base, Small, Medium, Large）以平衡速度和精度。
  - 支持 GPU 加速（如果可用）。
  - 输出格式选择（TXT, SRT）。
  - 实时显示转录日志/进度。

## 3. UI/UX 设计 (Flet)
- **设计风格**：采用 Material Design 3 风格，简洁现代化。
- **布局结构**：
  - 左侧/顶部导航栏切换三大功能模块。
  - 统一的卡片式内容区域。
  - 响应式布局，适应不同窗口大小。
- **交互体验**：
  - 异步操作，耗时任务不阻塞 UI。
  - 清晰的状态提示（加载中、成功、失败）。
  - 漂亮的深色/浅色主题切换（可选）。

## 4. 依赖管理
更新 `pyproject.toml`，添加以下依赖：
- `flet`: UI 框架
- `you-get`: 视频下载
- `openai-whisper`: 语音识别
- `ffmpeg-python`: ffmpeg 包装器 (或直接使用 subprocess 调用 ffmpeg)
- `torch`: Whisper 依赖 (uv 会自动处理)

## 5. 执行步骤
1.  **环境配置**：更新 `pyproject.toml` 并使用 `uv sync` 安装新依赖。
2.  **核心逻辑迁移**：将原 `main.py` 中的 `you-get` 和 `ffmpeg` 逻辑提取并重构到 `core/` 目录，并新增 Whisper 模块。
3.  **UI 开发**：使用 Flet 开发主框架和三个功能页面。
4.  **集成测试**：连接 UI 与核心逻辑，进行功能测试。
5.  **清理**：移除旧的 `tkinter` 代码。

确认后，我将开始执行此计划。